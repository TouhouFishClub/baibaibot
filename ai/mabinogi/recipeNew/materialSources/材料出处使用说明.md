# 材料出处管理系统使用说明

## 概述
这个系统可以自动替换配方百科中显示为"？"的材料出处信息，通过一个txt文件来管理所有材料的出处数据。

## 文件结构
```
ai/mabinogi/recipeNew/
├── materialSources/                 # 🎯 材料出处管理系统(完整目录)
│   ├── materialSources.txt          # 📝 材料出处数据文件
│   ├── MaterialSources.js           # 🔧 材料出处查找模块(带验证)
│   ├── MaterialSourcesData.js       # 🌐 浏览器兼容的数据文件
│   ├── syncToJS.js                  # 🔄 同步脚本
│   ├── validateMaterials.js         # ✅ 材料验证工具
│   └── 材料出处使用说明.md          # 📖 使用说明文档
├── js/
│   └── ErinnFormula..js             # ⚙️ 已修改：集成出处查找功能
└── ErinnFormula.html                # 🔗 已修改：加载数据文件
```

## 材料出处文件格式
`materialSources.txt` 文件格式：
```
材料1 出处1<br/>出处2
材料2 出处3
材料3 出处4<br/>出处5<br/>出处6
```

### 格式说明：
- 每行一个材料
- 材料名和出处之间用空格分隔
- 多个出处用 `<br/>` 分隔
- 支持中文材料名

### 示例：
```
青铜锭 商店购买<br/>采矿获得
黄金 赏金猎人<br/>挖掘获得<br/>NPC购买
银锭 商店购买<br/>挖掘获得
小麦 采集<br/>商店购买
牛奶 商店购买<br/>挤奶获得
```

## 使用方法

### 添加材料出处的步骤

1. **编辑数据文件**：
   - 打开文件：`ai/mabinogi/recipeNew/materialSources/materialSources.txt`
   - 按格式添加或修改材料信息：`材料名 出处1<br/>出处2`

2. **同步到浏览器环境**：
   ```bash
   cd ai/mabinogi/recipeNew
   node materialSources/syncToJS.js
   ```

3. **完成**：现在查询配方时就能看到正确的出处信息了

## 系统工作原理

1. **自动检测**：当配方系统准备显示"？"时，会自动调用材料出处查找功能
2. **出处查找**：根据材料名称在 `materialSources.txt` 文件中查找对应的出处信息
3. **动态替换**：如果找到对应的出处信息，则替换"？"；如果没找到，保持显示"？"
4. **热重载**：材料出处文件支持动态重新加载，无需重启系统

## 注意事项

1. **材料名称匹配**：必须与游戏中的实际材料名称完全一致
2. **文件编码**：`materialSources.txt` 文件应使用 UTF-8 编码
3. **出处格式**：多个出处用 `<br/>` 分隔，这样在网页中会正确换行显示
4. **备份建议**：定期备份 `materialSources.txt` 文件，避免数据丢失

## 扩展功能



## 常见问题

**Q: 为什么我添加的材料出处没有生效？**
A: 检查材料名称是否与游戏中完全一致，包括繁简体字符。

**Q: 如何批量导入大量材料出处？**
A: 直接编辑 `materialSources.txt` 文件，按格式添加多行材料信息即可。

**Q: 可以支持更复杂的出处格式吗？**
A: 当前支持 HTML 的 `<br/>` 标签进行换行，如需要其他格式可以修改 `MaterialSources.js` 文件。

## 版本记录

- v1.0: 初始版本，支持基本的材料出处管理和自动替换功能
